"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createStandardDelete = exports.processAll = exports.logAndExit = exports.readJson = exports.writeFile = exports.readFile = exports.groupBy = exports.setByKey = exports.setBy = exports.NONE = exports.getAll = exports.execute = exports.createRetry = exports.createLimiter = exports.later = void 0;
const categories_services_1 = require("./services/categories.services");
const cli_progress_1 = require("cli-progress");
const fs = require('fs');
const COOL_DOWN_PERIOD = Number(process.env.COOL_DOWN_PERIOD || 15) * 1000;
const MAX_ACTIVE = Number(process.env.MAX_ACTIVE || 25);
const RETRIES = Number(process.env.RETRIES || 5);
const later = (howLong, value) => new Promise((resolve) => setTimeout(() => resolve(value), howLong));
exports.later = later;
const promiseLike = (x) => x !== undefined && typeof x.then === 'function';
const ifPromise = (fn) => (x) => promiseLike(x) ? x.then(fn) : fn(x);
const createLimiter = (max = MAX_ACTIVE) => {
    var que = [];
    var queIndex = -1;
    var running = 0;
    const wait = (resolve, fn, arg) => () => resolve(ifPromise(fn)(arg)) || true; // should always return true
    const nextInQue = () => {
        ++queIndex;
        if (typeof que[queIndex] === 'function') {
            return que[queIndex]();
        }
        else {
            que = [];
            queIndex = -1;
            running = 0;
            return 'Does not matter, not used';
        }
    };
    const queItem = (fn, arg) => new Promise((resolve) => que.push(wait(resolve, fn, arg)));
    return (fn) => (arg) => {
        const p = queItem(fn, arg).then((x) => nextInQue() && x);
        running++;
        if (running <= max) {
            nextInQue();
        }
        return p;
    };
};
exports.createLimiter = createLimiter;
const createRetry = (retries = RETRIES) => {
    const execute = (fn, tries, args) => Promise.resolve()
        .then(() => fn.apply(null, args))
        .catch((error) => {
        // debugger
        tries++;
        if (error.body && error.body.statusCode === 401) {
            throw error;
        }
        if (tries > retries) {
            throw error;
        }
        return (0, exports.later)(COOL_DOWN_PERIOD).then(() => execute(fn, tries, args));
    });
    return (fn) => function retry() {
        return execute(fn, 0, [...arguments]);
    };
};
exports.createRetry = createRetry;
exports.execute = (0, exports.createLimiter)()((0, exports.createRetry)()(categories_services_1.client.execute.bind(categories_services_1.client)));
const getAll = (getterFn, service) => (request, statusCallback = (x) => x) => {
    const limit = 100;
    const recur = (result, getterFn, service, goOn, lastId, total) => {
        if (!goOn) {
            return result;
        }
        let uriBuilder = service
            .perPage(limit)
            .sort('id', true)
            .withTotal(total === undefined);
        if (lastId) {
            uriBuilder = uriBuilder.where(`id>"${lastId}"`);
        }
        return getterFn(Object.assign(Object.assign({}, request), { uri: uriBuilder.build() })).then((response) => {
            var _a;
            const all = result.concat(response.body.results);
            statusCallback(all.length, total || response.body.total);
            return recur(all, getterFn, service, response.body.count === limit, (_a = response.body.results.slice(-1)[0]) === null || _a === void 0 ? void 0 : _a.id, total || response.body.total);
        });
    };
    return recur([], getterFn, service, true);
};
exports.getAll = getAll;
exports.NONE = {};
const setBy = (getter) => (items) => items.reduce((items, item) => items.set(getter(item), item), new Map());
exports.setBy = setBy;
exports.setByKey = (0, exports.setBy)((item) => item.key);
const groupBy = (getter) => (items) => items.reduce((items, item) => items.set(getter(item), (items.get(getter(item)) || []).concat(item)), new Map());
exports.groupBy = groupBy;
const readFile = (filePath, encoding = 'utf8') => new Promise((resolve, reject) => fs.readFile(filePath, encoding, (err, fileContent) => err ? reject(err) : resolve(fileContent)));
exports.readFile = readFile;
const writeFile = (filePath, content) => new Promise((resolve, reject) => fs.writeFile(filePath, content, (err) => err ? reject(err) : resolve()));
exports.writeFile = writeFile;
const readJson = (filePath, encoding = 'utf8') => (0, exports.readFile)(filePath, encoding).then((fileContent) => JSON.parse(fileContent));
exports.readJson = readJson;
const logAndExit = (error, message) => {
    // eslint-disable-next-line no-console
    console.error(`${message}, see import-error.log for more details`);
    const log = Object.keys(error).length
        ? JSON.stringify(error, undefined, 2)
        : JSON.stringify({ message: error.massage, stack: error.stack }, undefined, 2);
    const exit = () => {
        process.exit(1);
    };
    return (0, exports.writeFile)('import-error.log', log).then(exit, exit);
};
exports.logAndExit = logAndExit;
const processAll = (getterFn, service, request, processor = (x) => x) => {
    const limit = 100;
    const recur = (result, getterFn, service, goOn, lastId, total) => {
        if (!goOn) {
            return result;
        }
        let uriBuilder = typeof service === 'function'
            ? service()
            : service
                .perPage(limit)
                .sort('id', true)
                .withTotal(total === undefined);
        if (lastId) {
            uriBuilder = uriBuilder.where(`id>"${lastId}"`);
        }
        const uri = uriBuilder.build();
        // console.log('getting:', uri)
        return getterFn(Object.assign(Object.assign({}, request), { uri })).then((response) => {
            // console.log(JSON.stringify(response, undefined, 2))
            return Promise.all(response.body.results.map((item) => processor(item, total || response.body.total))).then((processed) => {
                var _a;
                const all = result.concat(processed);
                return recur(all, getterFn, service, response.body.count === limit, (_a = response.body.results.slice(-1)[0]) === null || _a === void 0 ? void 0 : _a.id, total || response.body.total);
            });
        });
    };
    return recur([], getterFn, service, true);
};
exports.processAll = processAll;
const processWithNotify = (message, getterFn, service, request, processor = (x) => x) => {
    let notify = { stop: (x) => x };
    let started = false;
    const updateStatus = (done, total) => {
        if (!started) {
            notify = new cli_progress_1.SingleBar({
                format: message,
                barCompleteChar: '\u2588',
                barIncompleteChar: '\u2591'
            }, cli_progress_1.Presets.rect);
            notify.start(total);
            started = true;
        }
        notify.update(done);
    };
    let processed = 0;
    return (0, exports.processAll)(getterFn, service, request, (current, total) => Promise.resolve()
        .then(() => processor(current, total))
        .then((result) => {
        updateStatus(++processed, total);
        return result;
    })).then((result) => {
        notify.stop();
        return result;
    }, (err) => {
        notify.stop();
        return Promise.reject(err);
    });
};
const createStandardDelete = ({ itemName, service, deleteFunction = (item) => (0, exports.execute)({
    uri: (typeof service === 'function'
        ? service()
        : service)
        .byId(item.id)
        .withVersion(item.version)
        .build(),
    method: 'DELETE'
}) }) => () => {
    // eslint-disable-next-line no-console
    console.log('\x1b[32m%s\x1b[0m', `Deleting ${itemName}`);
    const spaces = (amount) => [...new Array(amount)].map(() => ' ').join('');
    return processWithNotify(`Delete ${itemName}${spaces(20 - itemName.length)}{bar} |` + '| {percentage}% || {value}/{total} items', exports.execute, service, {
        method: 'GET'
    }, deleteFunction).catch((err) => (0, exports.logAndExit)(err, `Failed to delete ${itemName}`));
};
exports.createStandardDelete = createStandardDelete;
// // Logging what requests are made can be convenient when debugging
// function requestLogger (httpModule){
//   var original = httpModule.request
//   httpModule.request = function (options, callback){
//     console.log(options.url)
//     return original(options, callback)
//   }
// }
// requestLogger(require('http'))
// requestLogger(require('https'))
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9oZWxwZXJzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUFBLHdFQUF1RDtBQUN2RCwrQ0FBaUQ7QUFFakQsTUFBTSxFQUFFLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQ3hCLE1BQU0sZ0JBQWdCLEdBQ3BCLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLGdCQUFnQixJQUFJLEVBQUUsQ0FBQyxHQUFHLElBQUksQ0FBQTtBQUNuRCxNQUFNLFVBQVUsR0FBRyxNQUFNLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksRUFBRSxDQUFDLENBQUE7QUFDdkQsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFBO0FBQ3pDLE1BQU0sS0FBSyxHQUFHLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxFQUFFLENBQ3RDLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLEVBQUUsQ0FDdEIsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLE9BQU8sQ0FBQyxLQUFLLENBQUMsRUFBRSxPQUFPLENBQUMsQ0FDMUMsQ0FBQTtBQUhVLFFBQUEsS0FBSyxTQUdmO0FBQ0gsTUFBTSxXQUFXLEdBQUcsQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUN4QixDQUFDLEtBQUssU0FBUyxJQUFJLE9BQU8sQ0FBQyxDQUFDLElBQUksS0FBSyxVQUFVLENBQUE7QUFDakQsTUFBTSxTQUFTLEdBQUcsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FDOUIsV0FBVyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUE7QUFDOUIsTUFBTSxh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